(function(a,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(a=typeof globalThis<"u"?globalThis:a||self,t(a.VueInfinityStack={},a.Vue))})(this,function(a,t){"use strict";const x=["id"],y=t.defineComponent({__name:"VueInfinityStack",props:{uuid:{default:""},visible:{type:Boolean},isAnimation:{type:Boolean,default:!0},zIndex:{default:1e3},autoIndex:{type:Boolean},storeName:{default:"historyState"},extra:{default:()=>({})},storeType:{default:"localStorage"},getContainer:{type:[Function,String],default:""},dynamic:{type:Boolean,default:!1},isAsync:{type:Boolean,default:!1},ishasAnimation:{type:Function,default:()=>{}}},emits:["update:visible","onOpen","onClose"],setup(d,{expose:w,emit:T}){const i=d,f=T,r=t.ref(null),g=t.ref(!0),p=t.ref(!1),c=t.ref(!1),u=t.ref(`popuplayer_${A()}`),h=t.ref(1e3);let m=null;function A(){return Array.from({length:8},(e,n)=>((1+Math.random())*65536|0).toString(16).substring(1)).join("")}function l(){const e=i.storeName||"historyState",n=window[i.storeType||"localStorage"],o=n.getItem(e)?JSON.parse(n.getItem(e)):[];return{reset(){(!n.getItem(e)||o.length)&&n.setItem(e,JSON.stringify([]))},update(s){n.setItem(e,JSON.stringify([...o,s]))},getCur(){return o},pop(){o.pop(),n.setItem(e,JSON.stringify(o))},push(s){n.setItem(e,JSON.stringify([...o,s]))}}}function S(e){var I;const n=((I=e.state)==null?void 0:I.id)||"",o=l().getCur(),s=o.length;if(s&&n!==o[s-1]&&o[s-1]===u.value){f("onClose",{isPopstate:!0},i.extra||{}),f("update:visible",!1),l().pop(),c.value=!0;const b=document.activeElement;b instanceof HTMLElement&&b.blur()}}t.watch(()=>i.visible,e=>{m&&clearTimeout(m),e?p.value=!0:m=setTimeout(()=>{p.value=!1,typeof i.ishasAnimation=="function"&&(g.value=!0)},300),t.nextTick(()=>{e?N():k(),window[e?"addEventListener":"removeEventListener"]("popstate",S)})});function N(){window.history.pushState({id:u.value},""),l().push(u.value),setTimeout(()=>{f("onOpen",u.value,i.extra||{})},200)}function k(){if(c.value){c.value=!1;return}f("onClose",{isPopstate:!1},i.extra||{}),l().pop(),history.back()}function O(){return Math.max(...Array.from(document.querySelectorAll("*")).map(e=>parseInt(window.getComputedStyle(e).zIndex)||1))}function E(e,n,o){for(let s=e+1;s<=n;s++)setTimeout(()=>{o==null||o(s)},s*30)}t.onMounted(()=>{let e=null;typeof i.getContainer=="function"?e=i.getContainer():i.getContainer&&(e=document.querySelector(i.getContainer)),e==null||e.appendChild(r.value),i.autoIndex&&(h.value=O()),!i.isAsync&&v()});function v(){const e=l().getCur(),n=(e==null?void 0:e.length)||0;n&&history.go(-n)}return t.onBeforeUnmount(()=>{var e;window.removeEventListener("popstate",S),(e=r.value)!=null&&e.parentNode&&r.value.parentNode.removeChild(r.value)}),w({asyncHandler:v,backLvBy:E}),(e,n)=>(t.openBlock(),t.createElementBlock("div",{style:t.normalizeStyle([{position:"fixed",top:"0",left:"0",bottom:"0",right:"0",width:"100%","backface-visibility":"hidden","background-color":"#fff"},{zIndex:e.autoIndex?h.value:e.zIndex,transform:e.visible?"translateX(0)":"translateX(100%)",transition:e.isAnimation&&g.value?"transform 0.3s":"none"}]),ref_key:"popupRef",ref:r,class:"popup-layer",id:e.uuid||u.value},[p.value?t.renderSlot(e.$slots,"default",{key:0}):t.createCommentVNode("",!0)],12,x))}}),C={install(d){d.component("VueInfinityStack",y)}};a.VueInfinityStack=y,a.default=C,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
