(function(a,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(a=typeof globalThis<"u"?globalThis:a||self,t(a.VueInfinityStack={},a.Vue))})(this,function(a,t){"use strict";const x=["id"],y=t.defineComponent({__name:"VueInfinityStack",props:{uuid:{default:""},visible:{type:Boolean},isAnimation:{type:Boolean,default:!0},zIndex:{default:1e3},autoIndex:{type:Boolean},storeName:{default:"historyState"},extra:{default:()=>({})},storeType:{default:"localStorage"},getContainer:{default:"body"},isAsync:{type:Boolean,default:!1},ishasAnimation:{type:Function,default:()=>{}}},emits:["update:visible","onOpen","onClose"],setup(d,{expose:C,emit:T}){const s=d,l=T,f=t.ref(null),h=t.ref(!0),p=t.ref(!1),c=t.ref(!1),r=t.ref(`popuplayer_${N()}`),g=t.ref(1e3);let m=null;function N(){return Array.from({length:8},(e,n)=>((1+Math.random())*65536|0).toString(16).substring(1)).join("")}function u(){const e=s.storeName||"historyState",n=window[s.storeType||"localStorage"],o=n.getItem(e)?JSON.parse(n.getItem(e)):[];return{reset(){(!n.getItem(e)||o.length)&&n.setItem(e,JSON.stringify([]))},update(i){n.setItem(e,JSON.stringify([...o,i]))},getCur(){return o},pop(){o.pop(),n.setItem(e,JSON.stringify(o))},push(i){n.setItem(e,JSON.stringify([...o,i]))}}}function S(e){var v;const n=((v=e.state)==null?void 0:v.id)||"",o=u().getCur(),i=o.length;if(i&&n!==o[i-1]&&o[i-1]===r.value){l("onClose",{isPopstate:!0},s.extra||{}),l("update:visible",!1),u().pop(),c.value=!0;const b=document.activeElement;b instanceof HTMLElement&&b.blur()}}t.watch(()=>s.visible,e=>{m&&clearTimeout(m),e?p.value=!0:m=setTimeout(()=>{p.value=!1,typeof s.ishasAnimation=="function"&&(h.value=!0)},300),t.nextTick(()=>{e?A():k(),window[e?"addEventListener":"removeEventListener"]("popstate",S)})});function A(){window.history.pushState({id:r.value},""),u().push(r.value),setTimeout(()=>{l("onOpen",r.value,s.extra||{})},200)}function k(){if(c.value){c.value=!1;return}l("onClose",{isPopstate:!1},s.extra||{}),u().pop(),history.back()}function O(){return Math.max(...Array.from(document.querySelectorAll("*")).map(e=>parseInt(window.getComputedStyle(e).zIndex)||1))}function V(e,n,o){for(let i=e+1;i<=n;i++)setTimeout(()=>{o==null||o(i)},i*30)}t.onMounted(()=>{s.autoIndex&&(g.value=O()),!s.isAsync&&I()});function I(){const e=u().getCur(),n=(e==null?void 0:e.length)||0;n&&history.go(-n)}return t.onBeforeUnmount(()=>{var e;window.removeEventListener("popstate",S),(e=f.value)!=null&&e.parentNode&&f.value.parentNode.removeChild(f.value)}),C({asyncHandler:I,backLvBy:V}),(e,n)=>(t.openBlock(),t.createBlock(t.Teleport,{to:e.getContainer},[t.createElementVNode("div",{style:t.normalizeStyle([{position:"fixed",top:"0",left:"0",bottom:"0",right:"0",width:"100%","backface-visibility":"hidden","background-color":"#fff"},{zIndex:e.autoIndex?g.value:e.zIndex,transform:e.visible?"translateX(0)":"translateX(100%)",transition:e.isAnimation&&h.value?"transform 0.3s":"none"}]),ref_key:"popupRef",ref:f,class:"popup-layer",id:e.uuid||r.value},[p.value?t.renderSlot(e.$slots,"default",{key:0}):t.createCommentVNode("",!0)],12,x)],8,["to"]))}}),w={install(d){d.component("VueInfinityStack",y)}};a.VueInfinityStack=y,a.default=w,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
