(function(t,d){typeof exports=="object"&&typeof module<"u"?module.exports=d(require("vue")):typeof define=="function"&&define.amd?define(["vue"],d):(t=typeof globalThis<"u"?globalThis:t||self,t.VueInfinityStack=d(t.Vue))})(this,function(t){"use strict";const d=["id"];return{__name:"VueInfinityStack",props:{uuid:{type:String,default:""},visible:Boolean,isAnimation:{type:Boolean,default:!0},zIndex:{type:Number,default:1e3},autoIndex:Boolean,storeName:{type:String,default:"historyState"},extra:{type:Object,default:()=>({})},storeType:{type:String,default:"localStorage"},getContainer:{type:[Function,String],default:""},isAsync:Boolean,ishasAnimation:{type:Function,default:()=>{}}},emits:["update:visible","onOpen","onClose"],setup(r,{expose:S,emit:I}){const o=r,f=I,b=()=>Array.from({length:8},(e,n)=>((1+Math.random())*65536|0).toString(16).substring(1)+([1,2,3,4].includes(n)?"-":"")).join(""),c=t.ref(null),g=t.ref(!0),m=t.ref(!0),y=t.ref(!1),p=t.ref(`popuplayer_${b()}`),v=t.ref(1e3);let h=null;const u=()=>{const e=o.storeName,n=window[o.storeType],s=JSON.parse,i=JSON.stringify,a=n.getItem(e)?s(n.getItem(e)):[];return{reset(){(!n.getItem(e)||a.length)&&n.setItem(e,i([]))},update(l){n.setItem(e,i([...a,l]))},getCur(){return a},pop(){a.pop(),n.setItem(e,i(a))},push(l){n.setItem(e,i([...a,l]))}}},x=e=>{var a,l;const n=((a=e.state)==null?void 0:a.id)||"",s=u().getCur(),i=s.length;i&&n!==s[i-1]&&s[i-1]===p.value&&(f("onClose",{isPopstate:!0},o.extra),f("update:visible",!1),u().pop(),y.value=!0,(l=document.activeElement)==null||l.blur())};t.watch(()=>o.visible,e=>{h&&clearTimeout(h),e?m.value=!0:h=setTimeout(()=>{m.value=!1,o.ishasAnimation&&(g.value=!0)},300),t.nextTick(()=>{e?C():w(),window[e?"addEventListener":"removeEventListener"]("popstate",x)})});const C=()=>{window.history.pushState({id:p.value},""),u().push(p.value),setTimeout(()=>{f("onOpen",p.value,o.extra)},200)},w=()=>{if(y.value)return y.value=!1;f("onClose",{isPopstate:!1},o.extra),u().pop(),history.back()},A=()=>{f("update:visible",!1)},T=()=>Math.max(...Array.from(document.querySelectorAll("*")).map(e=>parseInt(window.getComputedStyle(e).zIndex)||1)),k=(e,n,s)=>{for(let i=e+1;i<=n;i++)setTimeout(()=>{s==null||s(i)},i*30)};return t.onMounted(()=>{let e;if(typeof o.getContainer=="function"?e=o.getContainer():o.getContainer&&(e=document.querySelector(o.getContainer)),e==null||e.appendChild(c.value),o.autoIndex&&(v.value=T()),!o.isAsync){const n=u().getCur(),s=(n==null?void 0:n.length)||0;s&&history.go(-s),u().reset()}}),t.onBeforeUnmount(()=>{var e;window.removeEventListener("popstate",x),(e=c.value)!=null&&e.parentNode&&c.value.parentNode.removeChild(c.value)}),S({closeLv:A,backLvBy:k}),(e,n)=>(t.openBlock(),t.createElementBlock("div",{style:t.normalizeStyle([{position:"fixed",top:"0",left:"0",bottom:"0",right:"0",width:"100%","backface-visibility":"hidden","background-color":"#fff"},{zIndex:r.autoIndex?v.value:r.zIndex,transform:r.visible?"translateX(0)":"translateX(100%)",transition:r.isAnimation&&g.value?"transform 0.3s":"none"}]),ref_key:"popupRef",ref:c,class:"vue-infinity-stack",id:r.uuid||p.value},[m.value?t.renderSlot(e.$slots,"default",{key:0}):t.createCommentVNode("",!0)],12,d))}}});
